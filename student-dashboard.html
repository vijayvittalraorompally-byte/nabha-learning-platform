<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>📚 Student Dashboard</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/dashboard.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <nav class="navbar">
    <div class="nav-content">
      <h1 class="nav-title" id="navTitle">📚 Student Dashboard</h1>
      <div class="nav-actions">
        <select id="globalLang">
          <option value="en">English</option>
          <option value="pa">ਪੰਜਾਬੀ</option>
        </select>
        <button onclick="authManager.signOut()" class="logout-btn" id="logoutBtn">Logout</button>
      </div>
    </div>
  </nav>

  <main class="main-content">
    <!-- Videos Section -->
    <section id="videos" class="content-section active">
      <div class="section-header">
        <h2 id="videoSectionTitle">🎥 Educational Videos</h2>
      </div>
      <div class="video-grid" id="videoGrid">
        <!-- Videos load here -->
      </div>
    </section>

    <!-- Quizzes Section -->
    <section id="quizzes" class="content-section">
      <div class="section-header">
        <h2 id="quizSectionTitle">📝 Available Quizzes</h2>
      </div>
      <div class="quiz-grid" id="quizGrid">
        <!-- Quizzes load here -->
      </div>
    </section>
  </main>

  <!-- Video Player Modal -->
  <div class="modal" id="videoModal">
    <div class="modal-content video-modal-content">
      <span class="close" onclick="videoHandler.closeVideo()">&times;</span>
      <video id="videoPlayer" controls width="100%" height="400">
        <track id="subtitleTrack" kind="subtitles" srclang="en" label="English">
      </video>
      <div class="video-controls">
        <button onclick="toggleTranscript()" id="toggleTranscriptBtn">📑 Show Transcript</button>
        <button onclick="openFullscreen()" id="fullscreenBtn">⛶ Fullscreen</button>
      </div>
      <div class="video-info">
        <h3 id="videoTitle"></h3>
        <p id="videoDescription"></p>
        <div id="videoTranscript" style="display:none; margin-top:10px; background:#f5f5f5; padding:10px;"></div>
      </div>
    </div>
  </div>

  <script src="js/supabase.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/video-handler.js"></script>
  <script src="js/quiz-handler.js"></script>
  <script>
    const uiTexts = {
      en: { dashboard: "📚 Student Dashboard", logout: "Logout", videos: "🎥 Educational Videos", quizzes: "📝 Available Quizzes", showTranscript: "📑 Show Transcript", hideTranscript: "📑 Hide Transcript", fullscreen: "⛶ Fullscreen" },
      pa: { dashboard: "📚 ਵਿਦਿਆਰਥੀ ਡੈਸ਼ਬੋਰਡ", logout: "ਲਾੱਗ ਆਊਟ", videos: "🎥 ਸਿੱਖਿਆ ਵੀਡੀਓ", quizzes: "📝 ਉਪਲਬਧ ਕੁਇਜ਼", showTranscript: "📑 ਟ੍ਰਾਂਸਕ੍ਰਿਪਟ ਵੇਖੋ", hideTranscript: "📑 ਟ੍ਰਾਂਸਕ੍ਰਿਪਟ ਲੁਕਾਓ", fullscreen: "⛶ ਪੂਰੀ ਸਕਰੀਨ" }
    }

    function applyLang(lang) {
      const txt = uiTexts[lang]
      document.getElementById('navTitle').textContent = txt.dashboard
      document.getElementById('logoutBtn').textContent = txt.logout
      document.getElementById('videoSectionTitle').textContent = txt.videos
      document.getElementById('quizSectionTitle').textContent = txt.quizzes
      document.getElementById('toggleTranscriptBtn').textContent = txt.showTranscript
      document.getElementById('fullscreenBtn').textContent = txt.fullscreen
    }

    document.getElementById('globalLang').addEventListener('change', e => applyLang(e.target.value))
    applyLang('en')

    function toggleTranscript(){
      const box = document.getElementById('videoTranscript')
      const btn = document.getElementById('toggleTranscriptBtn')
      if(box.style.display === 'none'){
        box.style.display = 'block'
        btn.textContent = uiTexts[document.getElementById('globalLang').value].hideTranscript
      } else {
        box.style.display = 'none'
        btn.textContent = uiTexts[document.getElementById('globalLang').value].showTranscript
      }
    }

    function openFullscreen(){
      const player = document.getElementById('videoPlayer')
      if(player.requestFullscreen) player.requestFullscreen()
    }

    // Load videos on page load
    document.addEventListener("DOMContentLoaded", async () => {
      const videos = await videoHandler.getAllVideos()
      const grid = document.getElementById("videoGrid")
      grid.innerHTML = videos.map(v => `
        <div class="video-card" onclick='videoHandler.playVideo(${JSON.stringify(v)})'>
          <h4>${v.title}</h4>
          <p>${v.description || ''}</p>
        </div>
      `).join("")
    })
  </script>
</body>
</html>
