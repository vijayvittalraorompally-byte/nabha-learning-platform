<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Student Dashboard</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="js/supabase.js"></script>
  <script src="js/auth.js"></script>
  <style>
    body{font-family:Arial;margin:0;background:#f5f7fb}
    .nav{display:flex;justify-content:space-between;padding:1rem;background:#fff;box-shadow:0 1px 6px rgba(0,0,0,.06)}
    .container{max-width:1100px;margin:1rem auto;padding:1rem}
    .card{background:#fff;padding:1rem;border-radius:8px;margin-bottom:1rem}
    .btn{background:#667eea;color:#fff;padding:.5rem .8rem;border:none;border-radius:6px;cursor:pointer}
  </style>
</head>
<body>
  <div class="nav">
    <div><strong>ðŸ“š Student Dashboard</strong> <span id="studentName" style="color:#666;margin-left:8px">Loading...</span></div>
    <div>
      <button class="btn" id="home">Home</button>
      <button class="btn" id="logout">Logout</button>
    </div>
  </div>

  <div class="container">
    <div class="card">
      <h3>Videos</h3>
      <div id="videoList">Loading...</div>
    </div>

    <div class="card">
      <h3>Quizzes</h3>
      <div id="quizList">Loading...</div>
    </div>
  </div>

  <script src="js/quiz-handler.js"></script>
  <script>
    (async ()=>{
      await new Promise(r=>setTimeout(r,200));
      if (!window.authManager || !window.authManager.isStudent()) { window.location.replace('dashboard.html'); return; }
      document.getElementById('studentName').textContent = window.authManager.getDisplayName();
      document.getElementById('logout').addEventListener('click', ()=>window.authManager.signOut());
      document.getElementById('home').addEventListener('click', ()=>location.href='index.html');

      // load videos
      const { data: videos, error: vErr } = await window.db.getVideos();
      const vCon = document.getElementById('videoList');
      if (vErr) { vCon.textContent = 'Failed to load videos'; }
      else if (!videos.length) vCon.textContent = 'No videos';
      else vCon.innerHTML = videos.map(v => <div style="padding:.5rem;border-bottom:1px solid #eee"><strong>${v.title}</strong><br/><small>${v.description||''}</small><div style="margin-top:.3rem"><a href="video-player.html?id=${v.id}">Watch</a></div></div>).join('');

      // load quizzes
      const { data: quizzes, error: qErr } = await window.db.getQuizzes();
      const qCon = document.getElementById('quizList');
      if (qErr) qCon.textContent = 'Failed to load quizzes';
      else if (!quizzes.length) qCon.textContent = 'No quizzes';
      else qCon.innerHTML = quizzes.map(q => <div style="padding:.5rem;border-bottom:1px solid #eee"><strong>${q.title}</strong> â€¢ ${q.time_limit_minutes} min <div style="margin-top:.3rem"><button class="btn" onclick="startQuiz('${q.id}')">Start Quiz</button></div></div>).join('');
    })();
  </script>
</body>
</html>
