<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Digital Learning Platform</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading"></div>
        <p>Loading Dashboard...</p>
    </div>

    <script src="js/supabase.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/real-time.js"></script>
    <script>
        // Dashboard router based on user role
        async function initializeDashboard() {
            try {
                const { data: { user } } = await supabaseClient.auth.getUser();
                
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }

                // Get user profile
                const { data: profile } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('id', user.id)
                    .single();

                if (!profile) {
                    window.location.href = 'login.html';
                    return;
                }

                // Update user online status
                await supabaseClient
                    .from('users')
                    .update({ 
                        is_online: true, 
                        last_active: new Date().toISOString() 
                    })
                    .eq('id', user.id);

                // Redirect based on role
                if (profile.role === 'student') {
                    window.location.href = 'student-dashboard.html';
                } else if (profile.role === 'teacher') {
                    window.location.href = 'teacher-dashboard.html';
                } else {
                    window.location.href = 'teacher-dashboard.html'; // Default to teacher
                }
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                window.location.href = 'login.html';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>
